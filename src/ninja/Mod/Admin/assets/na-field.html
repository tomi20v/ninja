<!--
	na-field is a versatile element used for defining a field in a table, form, data, etc.
	normally it is used to define some structure which is used by other inner elements
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer/layout.html">
<link rel="import" href="../core-label/core-label.html">
<link rel="import" href="../core-menu/core-menu.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-dropdown/paper-dropdown.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-item/paper-item.html">
<polymer-element
	name="na-field"
	attributes="
		value
		key
		type
		auto
		collapsed
		default
		validatorUrl
		values
		min
		max
		multi
		label
		infoOnly
	"
>
	<template>

		<style>
			paper-input /deep/ paper-input-decorator {
				padding: 0.2em 0 0.75em;
			}
			paper-input /deep/ .floated-label {
				xline-height: 0.75em;
				font-size: 1em;
				font-size: 0.8em;
			}
			paper-dropdown-menu {
				margin: 0.1em 0 0.75em;
				padding-bottom: 0.1em;
				padding-top: 0.4em;
			}
			.fieldRow {
				display: block;
				margin: 0 2%;
				width: 96%;
				clear: both;
			}
			.fieldRow>span {
				color: #757575;
				font-size: 0.8em;
			}
			.fieldRow>span.labelS {
				width: 32%;
				overflow: hidden;
				overflow-style: marquee;
				margin-right: 4%;
				padding-top: 1em;
			}
			.fieldRow.checkboxRow {
				float: left;
				width: 46%;
				clear: none;
				height: 2.2em;
			}
			.fieldRow.checkboxRow>span {
				width: 80%;
				padding-top: 0.4em;
			}
		</style>

		<template if="{{ type=='checkbox' }}">
			<core-label horizontal layout center-left class="fieldRow checkboxRow na-fieldRow-{{ key }}">
				<span>{{ label || key }}</span>
				<paper-checkbox checked="{{ value }}" ></paper-checkbox>
			</core-label>
		</template>

		<template if="{{ type=='text' }}">
			<div horizontal layout center class="fieldRow textRow na-fieldRow-{{ key }}">
				<paper-input type="text" is="core-input" disabled="{{ infoOnly }}" flex
					   label="{{ label || key }}" floatingLabel
					   value="{{ value }}"
				></paper-input>
			</div>
		</template>

		<template if="{{ type=='label' }}">
			<core-label horizontal layout class="fieldRow labelRow na-fieldRow-{{ key }}">
				<span class="labelS">{{ label || key }}</span>
				<paper-input type="text" is="core-input" disabled="{{ infoOnly }}" flex
					   value="{{ value }}"
				></paper-input>
			</core-label>
		</template>

		<template if="{{ type=='select' }}" xbind="{{ 'label as _label' }}" >
			<core-label horizontal layout class="fieldRow selectRow na-fieldRow-{{ key }}" >
				<span class="labelS">{{ _label || key }}</span>
				<paper-dropdown-menu label="{{ label }}">
					<paper-dropdown class="dropdown">
						<core-menu class="menu" valueAttr="value" selected="{{ value }}">
							<template repeat="{{ option in options }}">
							<paper-item value="{{ option.value }}">{{ option.innerHTML }}</paper-item>
							</template>
						</core-menu>
					</paper-dropdown>
				</paper-dropdown-menu>
			</core-label>
		</template>

	</template>
	<script>
		Polymer('na-field', {
			/**
			 * @member {mixed} any value...
			 */
			value: null,
			/**
			 * @member {string} key in data row
			 */
			key: null,
			/**
			 * @member {string} type for showing and for input
			 */
			type: 'text',
			/**
			 * @member {bool} if set definition will be auto-guessed from schema NOT USED CURRENTLY
			 */
			auto: false,
			/**
			 * @member {bool} display the UI in collapsed state, useful eg. for large text editor
			 */
			collapsed: false,
			/**
			 * @member {mixed} default value
			 */
			default: null,
			/**
			 * @member string a url that acceots a value for this field and validates it
			 */
			validatorUrl: null,
			/**
			 * @member {string[]} valid values for select type
			 */
			values: null,
			/**
			 * @member {int} has minimum this many values
			 */
			hasMin: null,
			/**
			 * @member {int} has at most this many values
			 */
			hasMax: null,
			/**
			 * @member {string} will be used for header in table, or label in form
			 */
			label: null,
			/**
			 * @member {string[]} valid values for type member
			 */
			typeValues: [
				'label',
				'text',
				'textArea',
				'checkbox',
				'select',
				'radio',
				'icon'
			],
			// infoOnly sets input disabled
			infoOnly: false,
			// ??
			options: [],
			/**
			 * set up defaults before rendering
			 */
			created: function() {
				// @todo this does not work currently
				if (this.querySelectorAll('option').length) {
					console.log('found option');
				}
				this.options = this.querySelectorAll('option');
				!this.options.length || console.log(this.options);
			},
//			typeChanged: function() {
//				console.log('typeChanged', arguments, this);
//			},
			/**
			 * initialize me
			 */
			ready: function() {

				// this is an invalid field. I should do some cleanup here
				if (this.key === null) {
					return;
				}

				// check type and default if not set or invalid
				if (this.typeValues.indexOf(this.type) == -1) {
					this.type = this.typeValues[0];
				}

				this.options = this.querySelectorAll('option');
				if (this.options.length) {
					var optionsArr = [];
					for (var i in this.options) {
						if (!this.options.hasOwnProperty(i)) {
							continue;
						}
						optionsArr.push(this.options[i]);
					}
					this.options = optionsArr;
				}
			}
		});
		if (!Array.prototype.isArray) {
			Array.prototype.isArray = function() {
				return Object.prototype.toString(this) == Object.prototype.toString([]);
			}
		}
	</script>
</polymer-element>
