<!--
	na-field is a versatile element used for defining a field in a table, form, data, etc.
	normally it is used to define some structure which is used by other inner elements
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer/layout.html">
<link rel="import" href="../core-label/core-label.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-input/paper-input.html">
<polymer-element
	name="na-field"
	attributes="
		key
		type
		auto
		collapsed
		default
		validatorUrl
		values
		min
		max
		multi
		label
		infoOnly
		value
	"
>
	<template>

		<style>
			paper-input /deep/ paper-input-decorator {
				padding: 0.2em 0 0.75em;
			}
			paper-input /deep/ .floated-label {
				xline-height: 0.75em;
				font-size: 1em;
				font-size: 0.8em;
			}
			.fieldRow {
				display: block;
				margin: 0 2%;
				width: 96%;
				clear: both;
			}
			.fieldRow>span {
				color: #757575;
				font-size: 0.8em;
			}
			.labelRow>span {
				width: 32%;
				overflow: hidden;
				overflow-style: marquee;
				margin-right: 4%;
				padding-top: 1em;
			}
			.fieldRow.checkboxRow {
				float: left;
				width: 46%;
				clear: none;
			}
			.fieldRow.checkboxRow>span {
				width: 80%;
				padding-top: 0.4em;
			}
		</style>

		<template if="{{ type=='checkbox' }}">
			<core-label horizontal layout class="fieldRow checkboxRow na-fieldRow-{{ key }}">
				<span>{{ label || key }}</span>
				<paper-checkbox checked="{{ value }}" ></paper-checkbox>
			</core-label>
		</template>

		<template if="{{ type=='text' }}">
			<div horizontal layout center class="fieldRow textRow na-fieldRow-{{ key }}">
				<paper-input type="text" is="core-input" disabled="{{ infoOnly }}" flex
					   label="{{ label || key }}" floatingLabel
					   value="{{ value }}"
				/>
			</div>
		</template>

		<template if="{{ type=='label' }}">
			<core-label horizontal layout class="fieldRow labelRow na-fieldRow-{{ key }}">
				<span>{{ label || key }}</span>
				<paper-input type="text" is="core-input" disabled="{{ infoOnly }}" flex
					   value="{{ value }}"
				/>
			</core-label>
		</template>

	</template>
	<script>
		Polymer('na-field', {
			/**
			 * @member {string} key in data row
			 */
			key: null,
			/**
			 * @member {string} type for showing and for input
			 */
			type: 'text',
			/**
			 * @member {bool} if set definition will be auto-guessed from schema NOT USED CURRENTLY
			 */
			auto: false,
			/**
			 * @member {bool} display the UI in collapsed state, useful eg. for large text editor
			 */
			collapsed: false,
			/**
			 * @member {mixed} default value
			 */
			default: null,
			/**
			 * @member string a url that acceots a value for this field and validates it
			 */
			validatorUrl: null,
			/**
			 * @member {string[]} valid values for select type
			 */
			values: null,
			/**
			 * @member {int} has minimum this many values
			 */
			hasMin: null,
			/**
			 * @member {int} has at most this many values
			 */
			hasMax: null,
			/**
			 * @member {string} will be used for header in table, or label in form
			 */
			label: null,
			/**
			 * @member {string[]} valid values for type member
			 */
			typeValues: [
				'label',
				'text',
				'textArea',
				'checkbox',
				'select',
				'radio',
				'icon'
			],
			// infoOnly sets input disabled
			infoOnly: false,
			// ??
			options: null,
			/**
			 * set up defaults before rendering
			 */
			created: function() {
				// @todo this does not work currently
				if (this.querySelectorAll('option').length) {
					console.log('found option');
				}
			},
			typeChanged: function() {
				console.log('typeChanged', arguments, this);
			},
			/**
			 * initialize me
			 */
			ready: function() {

				// this is an invalid field. I should do some cleanup here
				if (this.key === null) {
					return;
				}

				// check type and default if not set or invalid
				if (this.typeValues.indexOf(this.type) == -1) {
					this.type = this.typeValues[0];
				}

				this.options = this.options === null
					? {}
					: this.options = this.options.split(',');

			}
		});
		if (!Array.prototype.isArray) {
			Array.prototype.isArray = function() {
				return Object.prototype.toString(this) == Object.prototype.toString([]);
			}
		}
	</script>
</polymer-element>
